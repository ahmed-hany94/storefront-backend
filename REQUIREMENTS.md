# My Design

## Setup:

```bash
git clone https://github.com/ahmed-hany94/storefront-backend

cd storefront-backend

yarn install
```

create `.env` file and fill it like below.

```bash
docker-compose up -d

yarn run migrate

yarn run migrate-test
```

Now you can run test

```bash
yarn run test
```

or start application

```bash
yarn start
```

## Environment:

- This is my `.env` file

```bash
POSTGRES_USER='postgres'
POSTGRES_HOST='127.0.0.1'
POSTGRES_DB_NAME='store'
POSTGRES_TEST_DB_NAME='store_test'
POSTGRES_PASSWORD='password'
JWT_SECRET="secret"
BCRYPT_SECRET="secret"
ENV='dev'
PORT=3000
DB_PORT=5432
TEST_DB_PORT=5433
SALT_ROUNDS=10
```

- Directory Structure:

```bash
├───controllers: Handles logic coming from routes.
├───db: Handles database queries logic.
├───models: Defines database schema entities.
├───modules: Defines common utilites & constants.
├───routes: Defines routes and middleware.
├───services: Handles logic that spans two databases entities.
└───tests: Defines tests
```

## Database Schema

_Based on the requirements below_

### `users` table

| column name     | type         | attriutes            |
| --------------- | ------------ | -------------------- |
| user_id (PK)    | uuid         | generated by default |
| username        | VARCHAR(100) | unique, not null     |
| firstname       | VARCHAR(100) | not null             |
| lastname        | VARCHAR(100) | not null             |
| hash            | VARCHAR(60)  | not null             |
| user_created_at | TIMESTAMP    | generated by default |

### `products` table

| column name        | type         | attriutes            |
| ------------------ | ------------ | -------------------- |
| prod_id (PK)       | uuid         | generated by default |
| name               | VARCHAR(100) | not null             |
| price              | decimal      | not null             |
| product_created_at | TIMESTAMP    | generated by default |

### `orders` table

| column name      | type      | attriutes                         |
| ---------------- | --------- | --------------------------------- |
| order_id (PK)    | uuid      | generated by default              |
| product_id (FK)  | uuid      | not null                          |
| user_id (FK)     | uuid      | not null                          |
| status           | text      | constraint ('active', 'complete') |
| order_created_at | TIMESTAMP | generated by default              |

### Database entities relationships

- User <--> Order (1-to-1)
- User <--> Product (1-to-Many)
- Order <--> Product (1-to-Many)

## API

| entity        | verb + route                        | front-end use                     | authenticated | JWT token |
| ------------- | ----------------------------------- | --------------------------------- | ------------- | --------- |
| user          | POST /users                         | sign-up                           | ❌            | ❌        |
| user          | GET /users                          | Get index of users                | ✅            | ❌        |
| auth          | POST /auth/login                    | sign-in                           | ❌            | ❌        |
| auth          | GET /auth/login                     | sign-out                          | ✅            | ✅        |
| user          | PUT /users/:userID                  | update user's account             | ✅            | ✅        |
| user          | DELETE /users/:userID               | delete user's account             | ✅            | ✅        |
| user          | GET /users/:userID                  | get user's account                | ✅            | ✅        |
| product       | POST /products                      | create product                    | ✅            | ❌        |
| product       | GET /products                       | get products                      | ❌            | ❌        |
| product       | GET /products/:prodID               | get product                       | ❌            | ❌        |
| user, product | POST /users/:userID/orders          | add to user's order               | ✅            | ✅        |
| user, product | GET /users/:userID/orders           | get user's order                  | ✅            | ✅        |
| user, product | GET /users/:userID/orders/active    | get user's order active orders    | ✅            | ✅        |
| user, product | GET /users/:userID/orders/completed | get user's order completed orders | ✅            | ✅        |

### API REST Client (vscode extension):

```
@token = Bearer _Enter code that returns when logging in_

@userID = _Enter code that returns when getting all users_

@productID1 = _Enter code that returns when getting all products_

@productID2 = _Enter code that returns when getting all products_

@productID3 = _Enter code that returns when getting all products_
####################################################################

# User SignUp

POST http://localhost:3000/api/users
Content-Type: application/json

{
"username": "a_hany",
"firstName": "ahmed",
"lastName": "hany",
"password": "ahmed_password"
}

####################################################################

# Get All Users

GET http://localhost:3000/api/users
Content-Type: application/json
Authorization: {{token}}

####################################################################

# Get User By ID

GET http://localhost:3000/api/users/{{userID}}
Content-Type: application/json
Authorization: {{token}}

####################################################################

# Update User

PUT http://localhost:3000/api/users/{{userID}}
Content-Type: application/json
Authorization: {{token}}

{
"username": "a_hany",
"firstName": "ahmed",
"lastName": "hany",
"password": "ahmed_password"
}

####################################################################

# Delete User

DELETE http://localhost:3000/api/users/{{userID}}
Content-Type: application/json
Authorization: {{token}}

####################################################################

# User Login

POST http://localhost:3000/api/auth/login
Content-Type: application/json

{
"username": "a_hany",
"password": "ahmed_password"
}

####################################################################

# User Logout

GET http://localhost:3000/api/auth/logout
Content-Type: application/json

####################################################################

# Get Products

GET http://localhost:3000/api/products
Content-Type: application/json

####################################################################

# Create Product

POST http://localhost:3000/api/products
Content-Type: application/json
Authorization: {{token}}

{
"name": "product",
"price": 9.99
}

####################################################################

# Get Product by ID

GET http://localhost:3000/api/products/{{productID2}}
Content-Type: application/json

####################################################################

# Create a User's order

POST http://localhost:3000/api/users/{{userID}}/orders
Content-Type: application/json
Authorization: {{token}}

{
"items": [
{
"product_id": "{{productID1}}",
"quantity": 3
},
{
"product_id": "{{productID2}}",
"quantity": 2
},
{
"product_id": "{{productID2}}",
"quantity": 14
}
],
"status": "active"
}

####################################################################

# Get a User's order

GET http://localhost:3000/api/users/{{userID}}/orders
Content-Type: application/json
Authorization: {{token}}

####################################################################

# Get a User's active order

GET http://localhost:3000/api/users/{{userID}}/orders/active
Content-Type: application/json
Authorization: {{token}}

####################################################################

# Get a User's completed order

GET http://localhost:3000/api/users/{{userID}}/orders/completed
Content-Type: application/json
Authorization: {{token}}

####################################################################

```

---

## API Requirements

The company stakeholders want to create an online storefront to showcase their great product ideas. Users need to be able to browse an index of all products, see the specifics of a single product, and add products to an order that they can view in a cart page. You have been tasked with building the API that will support this application, and your coworker is building the frontend.

These are the notes from a meeting with the frontend developer that describe what endpoints the API needs to supply, as well as data shapes the frontend and backend have agreed meet the requirements of the application.

### API Endpoints

##### Products

- Index
- Show
- Create [token required]
- [OPTIONAL] Top 5 most popular products
- [OPTIONAL] Products by category (args: product category)

##### Users

- Index [token required]
- Show [token required]
- Create N[token required]

##### Orders

- Current Order by user (args: user id)[token required]
- [OPTIONAL] Completed Orders by user (args: user id)[token required]

### Data Shapes

##### Product

- id
- name
- price
- [OPTIONAL] category

##### User

- id
- firstName
- lastName
- password

##### Orders

- id
- id of each product in the order
- quantity of each product in the order
- user_id
- status of order (active or complete)
